(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Cantabile=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){var objectCreate=Object.create||objectCreatePolyfill;var objectKeys=Object.keys||objectKeysPolyfill;var bind=Function.prototype.bind||functionBindPolyfill;function EventEmitter(){if(!this._events||!Object.prototype.hasOwnProperty.call(this,"_events")){this._events=objectCreate(null);this._eventsCount=0}this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;var defaultMaxListeners=10;var hasDefineProperty;try{var o={};if(Object.defineProperty)Object.defineProperty(o,"x",{value:0});hasDefineProperty=o.x===0}catch(err){hasDefineProperty=false}if(hasDefineProperty){Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:true,get:function(){return defaultMaxListeners},set:function(arg){if(typeof arg!=="number"||arg<0||arg!==arg)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=arg}})}else{EventEmitter.defaultMaxListeners=defaultMaxListeners}EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if(typeof n!=="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');this._maxListeners=n;return this};function $getMaxListeners(that){if(that._maxListeners===undefined)return EventEmitter.defaultMaxListeners;return that._maxListeners}EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)};function emitNone(handler,isFn,self){if(isFn)handler.call(self);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self)}}function emitOne(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1)}}function emitTwo(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}}function emitThree(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}}function emitMany(handler,isFn,self,args){if(isFn)handler.apply(self,args);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].apply(self,args)}}EventEmitter.prototype.emit=function emit(type){var er,handler,len,args,i,events;var doError=type==="error";events=this._events;if(events)doError=doError&&events.error==null;else if(!doError)return false;if(doError){if(arguments.length>1)er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Unhandled "error" event. ('+er+")");err.context=er;throw err}return false}handler=events[type];if(!handler)return false;var isFn=typeof handler==="function";len=arguments.length;switch(len){case 1:emitNone(handler,isFn,this);break;case 2:emitOne(handler,isFn,this,arguments[1]);break;case 3:emitTwo(handler,isFn,this,arguments[1],arguments[2]);break;case 4:emitThree(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];emitMany(handler,isFn,this,args)}return true};function _addListener(target,type,listener,prepend){var m;var events;var existing;if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');events=target._events;if(!events){events=target._events=objectCreate(null);target._eventsCount=0}else{if(events.newListener){target.emit("newListener",type,listener.listener?listener.listener:listener);events=target._events}existing=events[type]}if(!existing){existing=events[type]=listener;++target._eventsCount}else{if(typeof existing==="function"){existing=events[type]=prepend?[listener,existing]:[existing,listener]}else{if(prepend){existing.unshift(listener)}else{existing.push(listener)}}if(!existing.warned){m=$getMaxListeners(target);if(m&&m>0&&existing.length>m){existing.warned=true;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+' "'+String(type)+'" listeners '+"added. Use emitter.setMaxListeners() to "+"increase limit.");w.name="MaxListenersExceededWarning";w.emitter=target;w.type=type;w.count=existing.length;if(typeof console==="object"&&console.warn){console.warn("%s: %s",w.name,w.message)}}}}return target}EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,false)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,true)};function onceWrapper(){if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=true;switch(arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:var args=new Array(arguments.length);for(var i=0;i<args.length;++i)args[i]=arguments[i];this.listener.apply(this.target,args)}}}function _onceWrap(target,type,listener){var state={fired:false,wrapFn:undefined,target:target,type:type,listener:listener};var wrapped=bind.call(onceWrapper,state);wrapped.listener=listener;state.wrapFn=wrapped;return wrapped}EventEmitter.prototype.once=function once(type,listener){if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');this.on(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');this.prependListener(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');events=this._events;if(!events)return this;list=events[type];if(!list)return this;if(list===listener||list.listener===listener){if(--this._eventsCount===0)this._events=objectCreate(null);else{delete events[type];if(events.removeListener)this.emit("removeListener",type,list.listener||listener)}}else if(typeof list!=="function"){position=-1;for(i=list.length-1;i>=0;i--){if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener;position=i;break}}if(position<0)return this;if(position===0)list.shift();else spliceOne(list,position);if(list.length===1)events[type]=list[0];if(events.removeListener)this.emit("removeListener",type,originalListener||listener)}return this};EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;events=this._events;if(!events)return this;if(!events.removeListener){if(arguments.length===0){this._events=objectCreate(null);this._eventsCount=0}else if(events[type]){if(--this._eventsCount===0)this._events=objectCreate(null);else delete events[type]}return this}if(arguments.length===0){var keys=objectKeys(events);var key;for(i=0;i<keys.length;++i){key=keys[i];if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events=objectCreate(null);this._eventsCount=0;return this}listeners=events[type];if(typeof listeners==="function"){this.removeListener(type,listeners)}else if(listeners){for(i=listeners.length-1;i>=0;i--){this.removeListener(type,listeners[i])}}return this};function _listeners(target,type,unwrap){var events=target._events;if(!events)return[];var evlistener=events[type];if(!evlistener)return[];if(typeof evlistener==="function")return unwrap?[evlistener.listener||evlistener]:[evlistener];return unwrap?unwrapListeners(evlistener):arrayClone(evlistener,evlistener.length)}EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,true)};EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,false)};EventEmitter.listenerCount=function(emitter,type){if(typeof emitter.listenerCount==="function"){return emitter.listenerCount(type)}else{return listenerCount.call(emitter,type)}};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if(typeof evlistener==="function"){return 1}else if(evlistener){return evlistener.length}}return 0}EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function spliceOne(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}function arrayClone(arr,n){var copy=new Array(n);for(var i=0;i<n;++i)copy[i]=arr[i];return copy}function unwrapListeners(arr){var ret=new Array(arr.length);for(var i=0;i<ret.length;++i){ret[i]=arr[i].listener||arr[i]}return ret}function objectCreatePolyfill(proto){var F=function(){};F.prototype=proto;return new F}function objectKeysPolyfill(obj){var keys=[];for(var k in obj)if(Object.prototype.hasOwnProperty.call(obj,k)){keys.push(k)}return k}function functionBindPolyfill(context){var fn=this;return function(){return fn.apply(context,arguments)}}},{}],2:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],3:[function(require,module,exports){"use strict";const debug=require("debug")("Cantabile");const EndPoint=require("./EndPoint");const EventEmitter=require("events");class BindingWatcher extends EventEmitter{constructor(owner,name,indicies,condition,listener){super();this.owner=owner;this._name=name;this._indicies=indicies;this._condition=condition;this._listener=listener;this._value=null}get name(){return this._name}get indicies(){return this._indicies}get condition(){return this._condition}get value(){return this._value}_start(){this.owner.post("/watch",{name:this._name,indicies:this._indicies,condition:this._condition}).then(r=>{this.owner._registerWatchId(r.data.watchId,this);this._watchId=r.data.watchId;if(r.data.value!==null&&r.data.value!==undefined){this._value=r.data.value;this._fireInvoked()}})}_stop(){if(this.owner._epid&&this._watchId){this.owner.send("/unwatch",{watchId:this._watchId});this.owner._revokeWatchId(this._watchId);this._watchId=0;if(this._value!==null&&this._value!==undefined){this._value=null;this._fireInvoked()}}}unwatch(){this._stop();this.owner._revokeWatcher(this)}_update(data){this._value=data.value;this._fireInvoked()}_fireInvoked(){if(this._listener)this._listener(this._value,this);this.emit("invoked",this.value,this)}}class Bindings extends EndPoint{constructor(owner){super(owner,"/api/bindings");this._watchers=[];this._watchIds={}}_onOpen(){for(let i=0;i<this._watchers.length;i++){this._watchers[i]._start()}}_onClose(){for(let i=0;i<this._watchers.length;i++){this._watchers[i]._stop()}}async availableBindingPoints(){await this.owner.untilConnected();return(await this.request("GET","/availableBindingPoints")).data}async invoke(name,value,indicies,parameter){return await this.request("POST","/invoke",{name:name,value:value,indicies:indicies,parameter:parameter})}async query(name,indicies){return(await this.request("POST","/query",{name:name,indicies:indicies})).data.value}watch(name,indicies,condition,listener){let w=new BindingWatcher(this,name,indicies,condition,listener);this._watchers.push(w);if(this.isOpen)w._start()}_registerWatchId(watchId,watcher){this._watchIds[watchId]=watcher}_revokeWatchId(watchId){delete this._watchIds[watchId]}_revokeWatcher(w){this._watchers=this._watchers.filter(x=>x!=w)}_onEvent_invoked(data){let w=this._watchIds[data.watchId];if(w){w._update(data)}}}module.exports=Bindings},{"./EndPoint":5,debug:12,events:1}],4:[function(require,module,exports){(function(process){"use strict";const WebSocket=require("isomorphic-ws");const debug=require("debug")("Cantabile");const EventEmitter=require("events");class Cantabile extends EventEmitter{constructor(socketUrl){super();var defaultHost=process.browser?window.location.host:"localhost:35007";this.socketUrl=socketUrl||`ws://${defaultHost}/api/socket/`;this.shouldConnect=false;this._nextRid=1;this._pendingResponseHandlers={};this._endPointEventHandlers={};this._setState("disconnected");this.setList=new(require("./SetList"))(this);this.songStates=new(require("./SongStates"))(this);this.keyRanges=new(require("./KeyRanges"))(this);this.showNotes=new(require("./ShowNotes"))(this);this.variables=new(require("./Variables"))(this);this.bindings=new(require("./Bindings"))(this)}get state(){return this._state}connect(){this.shouldConnect=true;this._internalConnect()}disconnect(){this.shouldConnect=false;this._internalDisconnect()}send(obj){debug("SEND: %j",obj);this._ws.send(JSON.stringify(obj))}request(message){return new Promise(function(resolve,reject){message.rid=this._nextRid++;this._pendingResponseHandlers[message.rid]={message:message,resolve:resolve,reject:reject};this.send(message)}.bind(this))}untilConnected(){if(this._state=="connected"){return Promise.resolve()}else{return new Promise((resolve,reject)=>{if(!this.pendingConnectPromises)this.pendingConnectPromises=[resolve];else this.pendingConnectPromises.push(resolve)})}}_setState(value){if(this._state!=value){this._state=value;this.emit("stateChanged",value);this.emit(value);debug(value);if(this._state=="connected"){if(this.pendingConnectPromises){for(let i=0;i<this.pendingConnectPromises.length;i++){this.pendingConnectPromises[i]()}this.pendingConnectPromises=null}}}}_internalConnect(){if(!this.shouldConnect)return;if(this._ws)return;this._setState("connecting");debug("Opening web socket '%s'",this.socketUrl);this._ws=new WebSocket(this.socketUrl);this._ws.onerror=this._onSocketError.bind(this);this._ws.onopen=this._onSocketOpen.bind(this);this._ws.onclose=this._onSocketClose.bind(this);this._ws.onmessage=this._onSocketMessage.bind(this)}_internalDisconnect(){if(this.state=="connected")this._setState("disconnected");if(!this._ws)return;this._ws.close();delete this._ws}_internalReconnect(){if(this.shouldConnect&&!this.timeoutPending){this.timeoutPending=true;this._setState("connecting");setTimeout(function(){this.timeoutPending=false;this._internalConnect()}.bind(this),1e3)}}_onSocketError(evt){debug("socket error: %j",evt.error.message);this._internalDisconnect();this._internalReconnect()}_onSocketOpen(){this._setState("connected")}_onSocketClose(){if(this._ws){this._setState("disconnected");delete this._ws}this._internalReconnect()}_onSocketMessage(msg){msg=JSON.parse(msg.data);debug("RECV: %j",msg);if(msg.rid){let handlerInfo=this._pendingResponseHandlers[msg.rid];if(!handlerInfo){debug("ERROR: received response for unknown rid:",msg.rid);return}delete this._pendingResponseHandlers[msg.rid];if(msg.status>=200&&msg.status<300)handlerInfo.resolve(msg);else handlerInfo.reject(new Error(`${msg.status} - ${msg.statusDescription}`))}if(msg.epid&&msg.eventName){var ep=this._endPointEventHandlers[msg.epid];if(ep){ep._dispatchEventMessage(msg.eventName,msg.data)}else{debug(`ERROR: No event handler found for end point ${msg.epid}`)}}}_registerEndPointEventHandler(epid,endPoint){this._endPointEventHandlers[epid]=endPoint}_revokeEndPointEventHandler(epid){delete this._endPointEventHandlers[epid]}}const eventStateChanged="stateChanged";const eventConnected="connected";const eventConnecting="connecting";const eventDiconnected="disconnected";module.exports=Cantabile}).call(this,require("_process"))},{"./Bindings":3,"./KeyRanges":6,"./SetList":7,"./ShowNotes":8,"./SongStates":9,"./Variables":11,_process:2,debug:12,events:1,"isomorphic-ws":14}],5:[function(require,module,exports){"use strict";const debug=require("debug")("Cantabile");const EventEmitter=require("events");function joinPath(a,b){while(a.endsWith("/"))a=a.substr(0,a.length-1);while(b.startsWith("/"))b=b.substr(1);return`${a}/${b}`}class EndPoint extends EventEmitter{constructor(owner,endPoint){super();this.owner=owner;this.endPoint=endPoint;this.openCount=0;this.owner.on("connected",this._onConnected.bind(this));this.owner.on("disconnected",this._onDisconnected.bind(this))}open(){this.openCount++;if(this.openCount==1&&this.owner.state=="connected"){this._onConnected()}}close(){this.openCount--;if(this.openCount>0)return;this.owner.send({method:"close",epid:this._epid});this.owner._revokeEndPointEventHandler(this._epid);this._onClose();delete this._epid;delete this._data}send(method,endPoint,data){if(this._epid){return this.owner.send({ep:endPoint,epid:this._epid,method:method,data:data})}else{return this.owner.send({ep:joinPath(this.endPoint,endPoint),method:method,data:data})}}request(method,endPoint,data){if(this._epid){return this.owner.request({ep:endPoint,epid:this._epid,method:method,data:data})}else{return this.owner.request({ep:joinPath(this.endPoint,endPoint),method:method,data:data})}}post(endPoint,data){return this.request("post",endPoint,data)}get isOpen(){return!!this._epid}async _onConnected(){try{if(this.openCount==0)return;var msg=await this.owner.request({method:"open",ep:this.endPoint});this._epid=msg.epid;this._data=msg.data;this.owner._registerEndPointEventHandler(this._epid,this);this._onOpen()}catch(err){debug(err);throw err}}_onDisconnected(){if(this._epid)this.owner._revokeEndPointEventHandler(this._epid);delete this._epid;delete this._data;this._onClose()}_onOpen(){}_onClose(){}_dispatchEventMessage(eventName,data){if(this["_onEvent_"+eventName]){this["_onEvent_"+eventName](data)}}}module.exports=EndPoint},{debug:12,events:1}],6:[function(require,module,exports){"use strict";const debug=require("debug")("Cantabile");const EndPoint=require("./EndPoint");class KeyRanges extends EndPoint{constructor(owner){super(owner,"/api/keyranges")}_onOpen(){this.emit("changed")}get items(){return this._data?this._data.items:null}_onEvent_keyRangesChanged(data){this._data=data;this.emit("changed")}}module.exports=KeyRanges},{"./EndPoint":5,debug:12}],7:[function(require,module,exports){"use strict";const debug=require("debug")("Cantabile");const EndPoint=require("./EndPoint");class SetList extends EndPoint{constructor(owner){super(owner,"/api/setlist");this._currentSong=null}_onOpen(){this._resolveCurrentSong();this.emit("reload");this.emit("changed");this.emit("preLoadedChanged")}get items(){return this._data?this._data.items:null}get name(){return this._data?this._data.name:null}get preLoaded(){return this._data?this._data.preLoaded:false}get currentSongIndex(){return this._data.items.indexOf(this._currentSong)}get currentSong(){return this._currentSong}loadSongByIndex(index,delayed){this.post("/loadSongByIndex",{index:index,delayed:delayed})}loadSongByProgram(pr,delayed){this.post("/loadSongByProgram",{pr:pr,delayed:delayed})}loadFirstSong(delayed){this.post("/loadFirstSong",{delayed:delayed})}loadLastSong(delayed){this.post("/loadLastSong",{delayed:delayed})}loadNextSong(direction,delayed,wrap){this.post("/loadNextSong",{direction:direction,delayed:delayed,wrap:wrap})}_resolveCurrentSong(){if(this._data&&this._data.current>=0&&this._data.current<this._data.items.length){this._currentSong=this._data.items[this._data.current]}else{this._currentSong=null}}_onEvent_setListChanged(data){this._data=data;this._resolveCurrentSong();this.emit("reload");this.emit("changed");this.emit("preLoadedChanged")}_onEvent_itemAdded(data){this._data.items.splice(data.index,0,data.item);this.emit("itemAdded",data.index);this.emit("changed")}_onEvent_itemRemoved(data){this._data.items.splice(data.index,1);this.emit("itemRemoved",data.index);this.emit("changed")}_onEvent_itemMoved(data){var item=this._data.items[data.from];this._data.items.splice(data.from,1);this._data.items.splice(data.to,0,item);this.emit("itemMoved",data.from,data.to);this.emit("changed")}_onEvent_itemChanged(data){if(this.currentSongIndex==data.index)this._currentSong=data.item;this._data.items.splice(data.index,1,data.item);this.emit("itemChanged",data.index);this.emit("changed")}_onEvent_itemsReload(data){this._data.items=data.items;this._data.current=data.current;this._resolveCurrentSong();this.emit("reload");this.emit("changed")}_onEvent_preLoadedChanged(data){this._data.preLoaded=data.preLoaded;this.emit("preLoadedChanged")}_onEvent_currentSongChanged(data){this._data.current=data.current;this._resolveCurrentSong();this.emit("currentSongChanged")}_onEvent_nameChanged(data){if(this._data)this._data.name=data?data.name:null;this.emit("nameChanged");this.emit("changed")}}module.exports=SetList},{"./EndPoint":5,debug:12}],8:[function(require,module,exports){"use strict";const debug=require("debug")("Cantabile");const EndPoint=require("./EndPoint");class ShowNotes extends EndPoint{constructor(owner){super(owner,"/api/shownotes")}_onOpen(){this.emit("reload");this.emit("changed")}get items(){return this._data?this._data.items:null}_onEvent_itemAdded(data){this._data.items.splice(data.index,0,data.item);this.emit("itemAdded",data.index);this.emit("changed")}_onEvent_itemRemoved(data){this._data.items.splice(data.index,1);this.emit("itemRemoved",data.index);this.emit("changed")}_onEvent_itemMoved(data){var item=this._data.items[data.from];this._data.items.splice(data.from,1);this._data.items.splice(data.to,0,item);this.emit("itemMoved",data.from,data.to);this.emit("changed")}_onEvent_itemChanged(data){this._data.items.splice(data.index,1,data.item);this.emit("itemChanged",data.index);this.emit("changed")}_onEvent_itemsReload(data){this._data.items=data.items;this.emit("reload");this.emit("changed")}}module.exports=ShowNotes},{"./EndPoint":5,debug:12}],9:[function(require,module,exports){"use strict";const States=require("./States");class SongStates extends States{constructor(owner){super(owner,"/api/songStates")}}module.exports=SongStates},{"./States":10}],10:[function(require,module,exports){"use strict";const debug=require("debug")("Cantabile");const EndPoint=require("./EndPoint");class States extends EndPoint{constructor(owner,endPoint){super(owner,endPoint);this._currentState=null}_onOpen(){this._resolveCurrentState();this.emit("reload");this.emit("changed")}get items(){return this._data?this._data.items:null}get name(){return this._data?this._data.name:null}get currentStateIndex(){return this._data.items.indexOf(this._currentState)}get currentState(){return this._currentState}loadStateByIndex(index,delayed){this.post("/loadStateByIndex",{index:index,delayed:delayed})}loadStateByProgram(pr,delayed){this.post("/loadStateByProgram",{pr:pr,delayed:delayed})}loadFirstState(delayed){this.post("/loadFirstState",{delayed:delayed})}loadLastState(delayed){this.post("/loadLastState",{delayed:delayed})}loadNextState(direction,delayed,wrap){this.post("/loadNextState",{direction:direction,delayed:delayed,wrap:wrap})}_resolveCurrentState(){if(this._data&&this._data.current>=0&&this._data.current<this._data.items.length){this._currentState=this._data.items[this._data.current]}else{this._currentState=null}}_onEvent_songChanged(data){this._data=data;this._resolveCurrentState();this.emit("reload");this.emit("changed")}_onEvent_itemAdded(data){this._data.items.splice(data.index,0,data.item);this.emit("itemAdded",data.index);this.emit("changed")}_onEvent_itemRemoved(data){this._data.items.splice(data.index,1);this.emit("itemRemoved",data.index);this.emit("changed")}_onEvent_itemMoved(data){var item=this._data.items[data.from];this._data.items.splice(data.from,1);this._data.items.splice(data.to,0,item);this.emit("itemMoved",data.from,data.to);this.emit("changed")}_onEvent_itemChanged(data){if(this.currentStateIndex==data.index)this._currentState=data.item;this._data.items.splice(data.index,1,data.item);this.emit("itemChanged",data.index);this.emit("changed")}_onEvent_itemsReload(data){this._data.items=data.items;this._data.current=data.current;this._resolveCurrentState();this.emit("reload");this.emit("changed")}_onEvent_currentStateChanged(data){this._data.current=data.current;this._resolveCurrentState();this.emit("currentStateChanged")}_onEvent_nameChanged(data){if(this._data)this._data.name=data?data.name:null;this.emit("nameChanged");this.emit("changed")}}module.exports=States},{"./EndPoint":5,debug:12}],11:[function(require,module,exports){"use strict";const debug=require("debug")("Cantabile");const EndPoint=require("./EndPoint");const EventEmitter=require("events");class PatternWatcher extends EventEmitter{constructor(owner,pattern,listener){super();this.owner=owner;this._pattern=pattern;this._patternId=0;this._resolved="";this._listener=listener}get pattern(){return this._pattern}get resolved(){return this._resolved}_start(){this.owner.post("/watch",{pattern:this._pattern}).then(r=>{if(r.data.patternId){this.owner._registerPatternId(r.data.patternId,this);this._patternId=r.data.patternId}this._resolved=r.data.resolved;this._fireChanged()})}_stop(){if(this.owner._epid&&this._patternId){this.owner.send("/unwatch",{patternId:this._patternId});this.owner._revokePatternId(this._patternId);this._patternId=0;this.resolved="";this._fireChanged()}}unwatch(){this._stop();this.owner._revokeWatcher(this)}_update(data){this._resolved=data.resolved;this._fireChanged()}_fireChanged(){if(this._listener)this._listener(this.resolved,this);this.emit("changed",this.resolved,this)}}class Variables extends EndPoint{constructor(owner){super(owner,"/api/variables");this.watchers=[];this.patternIds={}}async resolve(pattern){await this.owner.untilConnected();return(await this.post("/resolve",{pattern:pattern})).data.resolved}_onOpen(){for(let i=0;i<this.watchers.length;i++){this.watchers[i]._start()}}_onClose(){for(let i=0;i<this.watchers.length;i++){this.watchers[i]._stop()}}watch(pattern,listener){let w=new PatternWatcher(this,pattern,listener);this.watchers.push(w);if(this.isOpen)w._start()}_registerPatternId(patternId,watcher){this.patternIds[patternId]=watcher}_revokePatternId(patternId){delete this.patternIds[patternId]}_revokeWatcher(w){this.watchers=this.watchers.filter(x=>x!=w)}_onEvent_patternChanged(data){let w=this.patternIds[data.patternId];if(w){w._update(data)}}}module.exports=Variables},{"./EndPoint":5,debug:12,events:1}],12:[function(require,module,exports){(function(process){exports=module.exports=require("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function useColors(){if(typeof window!=="undefined"&&window.process&&window.process.type==="renderer"){return true}if(typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return false}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}exports.formatters.j=function(v){try{return JSON.stringify(v)}catch(err){return"[UnexpectedJSONParseError]: "+err.message}};function formatArgs(args){var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return;var c="color: "+this.color;args.splice(1,0,c,"color: inherit");var index=0;var lastC=0;args[0].replace(/%[a-zA-Z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c)}function log(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem("debug")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}if(!r&&typeof process!=="undefined"&&"env"in process){r=process.env.DEBUG}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}}).call(this,require("_process"))},{"./debug":13,_process:2}],13:[function(require,module,exports){exports=module.exports=createDebug.debug=createDebug["default"]=createDebug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=require("ms");exports.instances=[];exports.names=[];exports.skips=[];exports.formatters={};function selectColor(namespace){var hash=0,i;for(i in namespace){hash=(hash<<5)-hash+namespace.charCodeAt(i);hash|=0}return exports.colors[Math.abs(hash)%exports.colors.length]}function createDebug(namespace){var prevTime;function debug(){if(!debug.enabled)return;var self=debug;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;var args=new Array(arguments.length);for(var i=0;i<args.length;i++){args[i]=arguments[i]}args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args.unshift("%O")}var index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});exports.formatArgs.call(self,args);var logFn=debug.log||exports.log||console.log.bind(console);logFn.apply(self,args)}debug.namespace=namespace;debug.enabled=exports.enabled(namespace);debug.useColors=exports.useColors();debug.color=selectColor(namespace);debug.destroy=destroy;if("function"===typeof exports.init){exports.init(debug)}exports.instances.push(debug);return debug}function destroy(){var index=exports.instances.indexOf(this);if(index!==-1){exports.instances.splice(index,1);return true}else{return false}}function enable(namespaces){exports.save(namespaces);exports.names=[];exports.skips=[];var i;var split=(typeof namespaces==="string"?namespaces:"").split(/[\s,]+/);var len=split.length;for(i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}for(i=0;i<exports.instances.length;i++){var instance=exports.instances[i];instance.enabled=exports.enabled(instance.namespace)}}function disable(){exports.enable("")}function enabled(name){if(name[name.length-1]==="*"){return true}var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:15}],14:[function(require,module,exports){(function(global){var ws=null;if(typeof WebSocket!=="undefined"){ws=WebSocket}else if(typeof MozWebSocket!=="undefined"){ws=MozWebSocket}else if(typeof global!=="undefined"){ws=global.WebSocket||global.MozWebSocket}else if(typeof window!=="undefined"){ws=window.WebSocket||window.MozWebSocket}else if(typeof self!=="undefined"){ws=self.WebSocket||self.MozWebSocket}module.exports=ws}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],15:[function(require,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};var type=typeof val;if(type==="string"&&val.length>0){return parse(val)}else if(type==="number"&&isNaN(val)===false){return options.long?fmtLong(val):fmtShort(val)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))};function parse(str){str=String(str);if(str.length>100){return}var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match){return}var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return undefined}}function fmtShort(ms){if(ms>=d){return Math.round(ms/d)+"d"}if(ms>=h){return Math.round(ms/h)+"h"}if(ms>=m){return Math.round(ms/m)+"m"}if(ms>=s){return Math.round(ms/s)+"s"}return ms+"ms"}function fmtLong(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n){return}if(ms<n*1.5){return Math.floor(ms/n)+" "+name}return Math.ceil(ms/n)+" "+name+"s"}},{}]},{},[4])(4)});